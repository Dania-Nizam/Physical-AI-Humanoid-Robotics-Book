# API Contracts: Vision-Language-Action (VLA) Pipeline

## Overview

This document defines the API contracts for the Vision-Language-Action (VLA) pipeline, including ROS 2 message types, service interfaces, and data exchange formats between different components of the system.

## ROS 2 Message Types

### VLACommand.msg
```
string command_text
float32 confidence_score
string interpreted_intent
string[] action_sequence
builtin_interfaces/Time timestamp
```

**Purpose**: Represents a voice command that has been processed by the speech recognition and LLM components.

### VLAActionResult.msg
```
bool success
string action_type
string error_message
builtin_interfaces/Time execution_time
```

**Purpose**: Represents the result of executing an action in the VLA pipeline.

### VLAPerceptionData.msg
```
sensor_msgs/Image camera_feed
sensor_msgs/PointCloud2 pointcloud
geometry_msgs/Pose[] object_poses
string[] object_classes
float32[] confidence_scores
builtin_interfaces/Time timestamp
```

**Purpose**: Contains perception data from the robot's sensors for use in the VLA pipeline.

## ROS 2 Services

### ProcessVoiceCommand.srv
```
# Request
string audio_data
string language

# Response
string transcription
string interpretation_json
bool success
string error_message
```

**Purpose**: Service to process voice commands and return interpretations.

### ExecuteActionSequence.srv
```
# Request
string[] action_sequence
float32 timeout_seconds

# Response
bool success
string[] execution_results
string error_message
```

**Purpose**: Service to execute a sequence of actions generated by the LLM.

## ROS 2 Actions

### VLAPipeline.action
```
# Goal
string voice_command
string target_object
geometry_msgs/Pose target_pose

# Result
bool success
string final_state
string[] action_log
builtin_interfaces/Time execution_duration

# Feedback
string current_action
string action_status
float32 progress_percentage
```

**Purpose**: Action interface for the complete VLA pipeline from voice command to robot action.

## Topic Interfaces

### Published Topics
- `/vla/command_input` - `std_msgs/String` - Raw voice commands
- `/vla/processed_command` - `VLACommand` - Processed and interpreted commands
- `/vla/action_result` - `VLAActionResult` - Results of action executions
- `/vla/perception_data` - `VLAPerceptionData` - Perception data for VLA processing
- `/vla/status` - `std_msgs/String` - Current status of the VLA pipeline

### Subscribed Topics
- `/isaac_ros/audio_input` - `sensor_msgs/Audio` - Audio input from Isaac Sim
- `/isaac_ros/camera/image_raw` - `sensor_msgs/Image` - Camera feed for perception
- `/isaac_ros/robot/pose` - `geometry_msgs/Pose` - Robot pose information
- `/isaac_ros/robot/joint_states` - `sensor_msgs/JointState` - Robot joint information

## Data Exchange Formats

### LLM Request Format
```json
{
  "command": "natural language command",
  "context": {
    "environment": "description of current environment",
    "robot_state": "current robot state",
    "perception_data": "relevant perception data"
  },
  "target_format": "structured action sequence"
}
```

### LLM Response Format
```json
{
  "intent": "action intent type",
  "action_sequence": [
    {
      "action_type": "navigation|manipulation|perception",
      "parameters": {
        "target_pose": {"x": 0.0, "y": 0.0, "z": 0.0, "qx": 0.0, "qy": 0.0, "qz": 0.0, "qw": 1.0},
        "target_object": "object name",
        "timeout": 10.0
      }
    }
  ],
  "confidence": 0.95
}
```

## Error Handling Contracts

### Error Codes
- `VLA_SUCCESS`: 0 - Operation completed successfully
- `VLA_SPEECH_RECOGNITION_FAILED`: 1 - Speech recognition failed
- `VLA_LLM_PROCESSING_FAILED`: 2 - LLM interpretation failed
- `VLA_ACTION_EXECUTION_FAILED`: 3 - Action execution failed
- `VLA_PERCEPTION_FAILED`: 4 - Perception pipeline failed
- `VLA_TIMEOUT`: 5 - Operation timed out
- `VLA_INVALID_COMMAND`: 6 - Invalid or uninterpretable command

### Error Response Format
```json
{
  "error_code": 1,
  "error_message": "Descriptive error message",
  "timestamp": "ISO 8601 timestamp",
  "component": "Component that generated the error"
}
```

## Performance Requirements

### Latency Requirements
- Speech recognition: < 1 second for 5-second audio clip
- LLM processing: < 3 seconds for command interpretation
- Action execution: < 10 seconds for simple navigation tasks
- Perception update: < 100ms for real-time applications

### Reliability Requirements
- Speech recognition accuracy: > 85% in quiet environments
- Command interpretation success rate: > 90% for valid commands
- Action execution success rate: > 80% for simple tasks
- System uptime: > 95% during active sessions